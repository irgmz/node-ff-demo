var growthbook=function(t){"use strict";const e={staleTTL:6e4,cacheKey:"gbFeaturesCache",backgroundSync:!0},n={fetch:globalThis.fetch?globalThis.fetch.bind(globalThis):void 0,SubtleCrypto:globalThis.crypto?globalThis.crypto.subtle:void 0,EventSource:globalThis.EventSource};try{globalThis.localStorage&&(n.localStorage=globalThis.localStorage)}catch(t){}const r=new Map;let i=!1;const s=new Map,o=new Map,u=new Map,h=new Set;async function c(){try{if(!n.localStorage)return;await n.localStorage.setItem(e.cacheKey,JSON.stringify(Array.from(s.entries())))}catch(t){}}function a(t){const[e,n]=t.getApiInfo();return["".concat(e,"||").concat(n),e,n]}function f(t,n){const i=n.dateUpdated||"",o=new Date(Date.now()+e.staleTTL),u=s.get(t);if(u&&i&&u.version===i)return void(u.staleAt=o);s.set(t,{data:n,version:i,staleAt:o}),c();const h=r.get(t);h&&h.forEach((t=>l(t,n)))}async function l(t,e){await(e.encryptedFeatures?t.setEncryptedFeatures(e.encryptedFeatures,void 0,n.SubtleCrypto):t.setFeatures(e.features||t.getFeatures()))}async function d(t){const[e,r,i]=a(t),s=r+"/api/features/"+i;let u=o.get(e);return u||(u=n.fetch(s).then((t=>("enabled"===t.headers.get("x-sse-support")&&h.add(e),t.json()))).then((n=>(f(e,n),w(t),o.delete(e),n))).catch((t=>(o.delete(e),Promise.resolve({})))),o.set(e,u)),await u}function w(t){const[r,i,s]=a(t);if(e.backgroundSync&&h.has(r)&&n.EventSource){if(u.has(r))return;const t={src:new n.EventSource("".concat(i,"/sub/").concat(s)),cb:e=>{try{const n=JSON.parse(e.data);f(r,n),t.errors=0}catch(e){y(t,r)}},errors:0};u.set(r,t),t.src.addEventListener("features",t.cb),t.src.onerror=()=>{y(t,r)}}}function y(t,e){t.errors++,(t.errors>3||2===t.src.readyState)&&b(t,e)}function b(t,e){t.src.onerror=null,t.src.close(),u.delete(e)}function p(){h.clear(),u.forEach(b),r.clear()}function g(t){let e=2166136261;const n=t.length;for(let r=0;r<n;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}function v(t,e,n){return 2===n?g(g(t+e)+"")%1e4/1e4:1===n?g(e+t)%1e3/1e3:-1}function $(t,e){return t>=e[0]&&t<e[1]}const A={};function m(t,e){if("$or"in e)return T(t,e.$or);if("$nor"in e)return!T(t,e.$nor);if("$and"in e)return function(t,e){for(let n=0;n<e.length;n++)if(!m(t,e[n]))return!1;return!0}(t,e.$and);if("$not"in e)return!m(t,e.$not);for(const[n,r]of Object.entries(e))if(!_(r,O(t,n)))return!1;return!0}function O(t,e){const n=e.split(".");let r=t;for(let t=0;t<n.length;t++){if(!r||"object"!=typeof r||!(n[t]in r))return null;r=r[n[t]]}return r}function _(t,e){if("string"==typeof t)return e+""===t;if("number"==typeof t)return 1*e===t;if("boolean"==typeof t)return!!e===t;if(Array.isArray(t)||!S(t))return JSON.stringify(e)===JSON.stringify(t);for(const n in t)if(!F(n,e,t[n]))return!1;return!0}function S(t){const e=Object.keys(t);return e.length>0&&e.filter((t=>"$"===t[0])).length===e.length}function F(t,e,n){switch(t){case"$eq":return e===n;case"$ne":return e!==n;case"$lt":return e<n;case"$lte":return e<=n;case"$gt":return e>n;case"$gte":return e>=n;case"$exists":return n?null!==e:null===e;case"$in":return n.includes(e);case"$nin":return!n.includes(e);case"$not":return!_(n,e);case"$size":return!!Array.isArray(e)&&_(n,e.length);case"$elemMatch":return function(t,e){if(!Array.isArray(t))return!1;const n=S(e)?t=>_(e,t):t=>m(t,e);for(let e=0;e<t.length;e++)if(t[e]&&n(t[e]))return!0;return!1}(e,n);case"$all":if(!Array.isArray(e))return!1;for(let t=0;t<n.length;t++){let r=!1;for(let i=0;i<e.length;i++)if(_(n[t],e[i])){r=!0;break}if(!r)return!1}return!0;case"$regex":try{return(r=n,A[r]||(A[r]=new RegExp(r.replace(/([^\\])\//g,"$1\\/"))),A[r]).test(e)}catch(t){return!1}case"$type":return function(t){if(null===t)return"null";if(Array.isArray(t))return"array";const e=typeof t;return["string","number","boolean","object","undefined"].includes(e)?e:"unknown"}(e)===n;default:return console.error("Unknown operator: "+t),!1}var r}function T(t,e){if(!e.length)return!0;for(let n=0;n<e.length;n++)if(m(t,e[n]))return!0;return!1}const k="undefined"!=typeof window&&"undefined"!=typeof document,E=t=>Uint8Array.from(atob(t),(t=>t.charCodeAt(0)));return t.GrowthBook=class{constructor(t){this.t=this.context=t=t||{},this.i=null,this.o=new Set,this.u={},this.debug=!1,this.h=new Set,this.l=[],this.p=0,this.ready=!1,this.g=new Map,this.v=new Map,this.$={},t.features&&(this.ready=!0),k&&t.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),t.clientKey&&this.A({},!0,!1)}async loadFeatures(t){await this.A(t,!0,!0),t&&t.autoRefresh&&function(t){const[e]=a(t),n=r.get(e)||new Set;n.add(t),r.set(e,n)}(this)}async refreshFeatures(t){await this.A(t,!1,!0)}getApiInfo(){return[(this.t.apiHost||"https://cdn.growthbook.io").replace(/\/*$/,""),this.t.clientKey||""]}async A(t,r,o){if(t=t||{},!this.t.clientKey)throw new Error("Missing clientKey");await async function(t,r,o,u,h){const c=await async function(t,r,o,u){const[h]=a(t),c=new Date;await async function(){if(!i){i=!0;try{if(n.localStorage){const t=await n.localStorage.getItem(e.cacheKey);if(t){const e=JSON.parse(t);e&&Array.isArray(e)&&e.forEach((t=>{let[e,n]=t;s.set(e,{...n,staleAt:new Date(n.staleAt)})}))}}}catch(t){}}}();const f=s.get(h);if(f&&!u&&(r||f.staleAt>c))return f.staleAt<c?d(t):w(t),f.data;{const e=await function(t,e){return new Promise((n=>{let r,i=!1;const s=t=>{i||(i=!0,r&&clearTimeout(r),n(t||null))};e&&(r=setTimeout((()=>s()),e)),t.then((t=>s(t))).catch((()=>s()))}))}(d(t),o);return e}}(t,u,r,o);h&&c&&await l(t,c)}(this,t.timeout,t.skipCache||this.t.enableDevMode,r,o)}m(){this.i&&this.i()}setFeatures(t){this.t.features=t,this.ready=!0,this.m()}async setEncryptedFeatures(t,e,n){if(e=e||this.t.decryptionKey||"",!(n=n||globalThis.crypto&&globalThis.crypto.subtle))throw new Error("No SubtleCrypto implementation found");try{const r=await n.importKey("raw",E(e),{name:"AES-CBC",length:128},!0,["encrypt","decrypt"]),[i,s]=t.split("."),o=await n.decrypt({name:"AES-CBC",iv:E(i)},r,E(s));this.setFeatures(JSON.parse((new TextDecoder).decode(o)))}catch(t){throw new Error("Failed to decrypt features")}}setAttributes(t){this.t.attributes=t,this.m()}setAttributeOverrides(t){this.$=t,this.m()}setForcedVariations(t){this.t.forcedVariations=t||{},this.m()}setForcedFeatures(t){this.v=t,this.m()}getAttributes(){return{...this.t.attributes,...this.$}}getFeatures(){return this.t.features||{}}subscribe(t){return this.h.add(t),()=>{this.h.delete(t)}}getAllResults(){return new Map(this.g)}destroy(){var t;this.h.clear(),this.g.clear(),this.o.clear(),this.u={},this.l=[],this.p&&clearTimeout(this.p),t=this,r.forEach((e=>e.delete(t))),k&&window._growthbook===this&&delete window._growthbook}setRenderer(t){this.i=t}forceVariation(t,e){this.t.forcedVariations=this.t.forcedVariations||{},this.t.forcedVariations[t]=e,this.m()}run(t){const e=this.O(t,null);return this._(t,e),e}_(t,e){const n=t.key,r=this.g.get(n);r&&r.result.inExperiment===e.inExperiment&&r.result.variationId===e.variationId||(this.g.set(n,{experiment:t,result:e}),this.h.forEach((n=>{try{n(t,e)}catch(t){console.error(t)}})))}S(t,e){if("override"===e.source)return;const n=JSON.stringify(e.value);if(this.u[t]!==n){if(this.u[t]=n,this.t.onFeatureUsage)try{this.t.onFeatureUsage(t,e)}catch(t){}k&&window.fetch&&(this.l.push({key:t,on:e.on}),this.p||(this.p=window.setTimeout((()=>{this.p=0;const t=[...this.l];this.l=[],this.t.realtimeKey&&window.fetch("https://rt.growthbook.io/?key=".concat(this.t.realtimeKey,"&events=").concat(encodeURIComponent(JSON.stringify(t))),{cache:"no-cache",mode:"no-cors"}).catch((()=>{}))}),this.t.realtimeInterval||2e3)))}}F(t,e,n,r,i,s){const o={value:e,on:!!e,off:!e,source:n,ruleId:r||""};return i&&(o.experiment=i),s&&(o.experimentResult=s),this.S(t,o),o}isOn(t){return this.evalFeature(t).on}isOff(t){return this.evalFeature(t).off}getFeatureValue(t,e){const n=this.evalFeature(t).value;return null===n?e:n}feature(t){return this.evalFeature(t)}evalFeature(t){if(this.v.has(t))return this.F(t,this.v.get(t),"override");if(!this.t.features||!this.t.features[t])return this.F(t,null,"unknownFeature");const e=this.t.features[t];if(e.rules)for(const n of e.rules){if(n.condition&&!this.T(n.condition))continue;if(n.filters&&this.k(n.filters))continue;if("force"in n){if(!this.V(n.seed||t,n.hashAttribute,n.range,n.coverage,n.hashVersion))continue;return n.tracks&&n.tracks.forEach((t=>{this.M(t.experiment,t.result)})),this.F(t,n.force,"force",n.id)}if(!n.variations)continue;const e={variations:n.variations,key:n.key||t};"coverage"in n&&(e.coverage=n.coverage),n.weights&&(e.weights=n.weights),n.hashAttribute&&(e.hashAttribute=n.hashAttribute),n.namespace&&(e.namespace=n.namespace),n.meta&&(e.meta=n.meta),n.ranges&&(e.ranges=n.ranges),n.name&&(e.name=n.name),n.phase&&(e.phase=n.phase),n.seed&&(e.seed=n.seed),n.hashVersion&&(e.hashVersion=n.hashVersion),n.filters&&(e.filters=n.filters);const r=this.O(e,t);if(this._(e,r),r.inExperiment&&!r.passthrough)return this.F(t,r.value,"experiment",n.id,e,r)}return this.F(t,void 0===e.defaultValue?null:e.defaultValue,"defaultValue")}V(t,e,n,r,i){if(!n&&void 0===r)return!0;const{hashValue:s}=this.C(e);if(!s)return!1;const o=v(t,s,i||1);return n?$(o,n):void 0===r||o<=r}T(t){return m(this.getAttributes(),t)}k(t){return t.some((t=>{const{hashValue:e}=this.C(t.attribute);if(!e)return!0;const n=v(t.seed,e,t.hashVersion||2);return!t.ranges.some((t=>$(n,t)))}))}O(t,e){const n=t.key,r=t.variations.length;if(r<2)return this.I(t,-1,!1,e);if(!1===this.t.enabled)return this.I(t,-1,!1,e);t=this.N(t);const i=function(t,e,n){if(!e)return null;const r=e.split("?")[1];if(!r)return null;const i=r.replace(/#.*/,"").split("&").map((t=>t.split("=",2))).filter((e=>{let[n]=e;return n===t})).map((t=>{let[,e]=t;return parseInt(e)}));return i.length>0&&i[0]>=0&&i[0]<n?i[0]:null}(n,this.j(),r);if(null!==i)return this.I(t,i,!1,e);if(this.t.forcedVariations&&n in this.t.forcedVariations)return this.I(t,this.t.forcedVariations[n],!1,e);if("draft"===t.status||!1===t.active)return this.I(t,-1,!1,e);const{hashValue:s}=this.C(t.hashAttribute);if(!s)return this.I(t,-1,!1,e);if(t.filters){if(this.k(t.filters))return this.I(t,-1,!1,e)}else if(t.namespace&&!function(t,e){const n=v("__"+e[0],t,1);return n>=e[1]&&n<e[2]}(s,t.namespace))return this.I(t,-1,!1,e);if(t.include&&!function(t){try{return t()}catch(t){return console.error(t),!1}}(t.include))return this.I(t,-1,!1,e);if(t.condition&&!this.T(t.condition))return this.I(t,-1,!1,e);if(t.groups&&!this.J(t.groups))return this.I(t,-1,!1,e);if(t.url&&!this.R(t.url))return this.I(t,-1,!1,e);const o=v(t.seed||n,s,t.hashVersion||1),u=function(t,e){for(let n=0;n<e.length;n++)if($(t,e[n]))return n;return-1}(o,t.ranges||function(t,e,n){(e=void 0===e?1:e)<0?e=0:e>1&&(e=1);const r=(i=t)<=0?[]:new Array(i).fill(1/i);var i;(n=n||r).length!==t&&(n=r);const s=n.reduce(((t,e)=>e+t),0);(s<.99||s>1.01)&&(n=r);let o=0;return n.map((t=>{const n=o;return o+=t,[n,n+e*t]}))}(r,void 0===t.coverage?1:t.coverage,t.weights));if(u<0)return this.I(t,-1,!1,e);if("force"in t)return this.I(t,void 0===t.force?-1:t.force,!1,e);if(this.t.qaMode)return this.I(t,-1,!1,e);if("stopped"===t.status)return this.I(t,-1,!1,e);const h=this.I(t,u,!0,e,o);return this.M(t,h),h}log(t,e){this.debug&&(this.t.log?this.t.log(t,e):console.log(t,e))}M(t,e){if(!this.t.trackingCallback)return;const n=e.hashAttribute+e.hashValue+t.key+e.variationId;if(!this.o.has(n)){this.o.add(n);try{this.t.trackingCallback(t,e)}catch(t){console.error(t)}}}N(t){const e=t.key,n=this.t.overrides;return n&&n[e]&&"string"==typeof(t=Object.assign({},t,n[e])).url&&(t.url=function(t){try{const e=t.replace(/([^\\])\//g,"$1\\/");return new RegExp(e)}catch(t){return void console.error(t)}}(t.url)),t}C(t){const e=t||"id";let n="";return this.$[e]?n=this.$[e]:this.t.attributes?n=this.t.attributes[e]||"":this.t.user&&(n=this.t.user[e]||""),{hashAttribute:e,hashValue:n}}I(t,e,n,r,i){let s=!0;(e<0||e>=t.variations.length)&&(e=0,s=!1);const{hashAttribute:o,hashValue:u}=this.C(t.hashAttribute),h=t.meta?t.meta[e]:{},c={key:h.key||""+e,featureId:r,inExperiment:s,hashUsed:n,variationId:e,value:t.variations[e],hashAttribute:o,hashValue:u};return h.name&&(c.name=h.name),void 0!==i&&(c.bucket=i),h.passthrough&&(c.passthrough=h.passthrough),c}j(){return this.t.url||(k?window.location.href:"")}R(t){const e=this.j();if(!e)return!1;const n=e.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/");return!!t.test(e)||!!t.test(n)}J(t){const e=this.t.groups||{};for(let n=0;n<t.length;n++)if(e[t[n]])return!0;return!1}},t.clearCache=async function(){s.clear(),o.clear(),p(),i=!1,await c()},t.configureCache=function(t){Object.assign(e,t),e.backgroundSync||p()},t.setPolyfills=function(t){Object.assign(n,t)},Object.defineProperty(t,"U",{value:!0}),t}({});
//# sourceMappingURL=index.min.js.map
